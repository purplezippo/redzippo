---
title: R中大数值数据的表示和计算
author: 雨禾
date: '2018-12-12'
slug: r中大数值数据的表示和计算
categories:
  - R
tags:
  - data clean
---

## 科学计数转换
R 默认对超过一定位数的数值采用科学计数法表示，但有时候直查看数据还是直接展示更加直观。
```{r}
format(1.11011E+16, scientific = FALSE, digits = 0)
```
也可以通过设置options参数更改系统默认行为

```{r}
12345600000000000000
```

```{r}
options(scipen = 20)
12345600000000000000
```


## 大数值数据
为了看出差别先把科学计数显示的位数设高些
```{r}
options(scipen = 100)
```
对于大数值（超过23位的数据）会产生精度问题，无论是直接输入还是用科学计数法都会由于精度问出现误差：

```{r}
100000000000000000000000
```

```{r}
format(1E+28, scientific = FALSE)

```

以及计算错误：
```{r}
a <- 1000000000000000000000000
b <- a + 1
a == b 
```

此时可通过使用`gmp`和`Rmpfr`包来解决， 其中`gmp`是`Rmpfr`的依赖包所以只用安装后者即可。需要注意的是
输入数据必须是**字符型**的，数值型数据在作为参数传入时会被函数的执行环境改变，从而无法完成转换。
```{r}
gmp::as.bigz('100000000000000000000000000000000')  # 传入数据得是字符型
```
对比：
```{r}
as.numeric('100000000000000000000000000000000')
```
当然，此类差别在低精度情况下是不存在的。此外，一些常量也可以通过`Rmpfr`来获取，比如pi:
```{r}
library(Rmpfr)
Const("pi", prec = 160)

```

```{r}
Const("pi", prec = 1024)
```


通过设置比特精度，可以实现任意大值数据的转换，甚至是字符型的科学计数法数据也没问题，有些时候从excel读取的数据会被直接转换成类似'1.23E+30'的字符格式，想要还原数据的本来面目可以采用以下的函数：
低精度时依然存在误差
```{r}
mpfr('100000000000000000000000000', prec = 10) 
```

将精度调高即可解决问题
```{r}
mpfr('100000000000000000000000000', prec = 100) 
```

对于科学计数法表示的数据也可以正常转换
```{r}
mpfr('1e+30', prec = 100) 
```




